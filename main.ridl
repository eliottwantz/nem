webrpc = v1

name = nem
version = v0.1.0


#################### STRUCTS ####################

struct User
    - id: string
    - email: string
    - firstName: string
    - lastName: string
    - role: string
    - preferedLanguage: string
    - avatarFilePath: string
    - avatarUrl: string
    - createdAt: timestamp
    - updatedAt: timestamp

struct Teacher
    - id: string
    - email: string
    - firstName: string
    - lastName: string
    - role: string
    - preferedLanguage: string
    - avatarFilePath: string
    - avatarUrl: string
    - bio: string
    - hourRate: int32
    - topAgent: bool
    - spokenLanguages: []SpokenLanguage
    - topicsTaught: []TopicTaught
    - createdAt: timestamp
    - updatedAt: timestamp

struct SpokenLanguage
    - id: int32
    - language: string
    - proficiency: string

struct CreateStudentRequest
    - firstName: string
    - lastName: string
    - email: string
    - role: string
    - preferedLanguage: string

struct CreateTeacherRequest
    - firstName: string
    - lastName: string
    - email: string
    - role: string
    - preferedLanguage: string
    - bio: string
    - hourRate: int32
    - spokenLanguages: []CreateTeacherRequestSpokenLanguage

struct CreateTeacherRequestSpokenLanguage
    - language: string
    - proficiency: string

struct TopicTaught
    - id: int32
    - language: string
    - topic: string


struct Class
    - id: string
    - teacherId: string
    - isPrivate: bool
    - name: string
    - hasStarted: bool
    - language: string
    - topic: string
    - startAt: timestamp
    - endAt: timestamp
    - createdAt: timestamp

struct ClassDetails
    - class: Class
    - users: []User
    - teacher: Teacher


struct Message
    - text: string
    - classId: string

struct MessageResponse
    - id: string
    - text: string
    - createdAt: timestamp
    - updatedAt: timestamp
    - classId: string
    - user: User

struct TimesRequest
    - startAt: timestamp
    - endAt: timestamp

struct AddAvailabilityRequest
    - times: []TimesRequest
    - startAt: timestamp
    - endAt: timestamp

struct EditAvailabilityRequest
    - id: string
    - times: []TimesRequest
    - startAt: timestamp
    - endAt: timestamp

struct TimeSlot
    - id: string
    - teacherId: string
    - startAt: timestamp
    - endAt: timestamp

struct CreateClassRequest
    - name: string
    - isPrivate: bool
    - topicTaughtId: int32
    - timeSlotId: string


#################### STRUCTS ####################


#################### SERVICES ####################

service UserServiceAPI
    - Get() => (user: User)
    - FindUserByID(id: string) => (user: User)
    - FindTeacherByID(id: string) => (teacher: Teacher)
    - CreateStudent(req: CreateStudentRequest) 
    - CreateTeacher(req: CreateTeacherRequest)
    - UpdatePreferedLanguage(lang: string)
    - UpdateAvatar(path: string, url: string)
    - DeleteAvatar()
    - Delete()

service StudentServiceAPI
    - ListClasses() => (classes: []Class)
    - ListTeachers() => (teachers: []Teacher)
    - JoinClass(classId: string)
    - LeaveClass(classId: string)

service TeacherServiceAPI
    - ListClasses() => (classes: []Class)
    - ListStudents() => (students: []User)
    - ListTopicsTaught() => (topicsTaught: []TopicTaught)
    - Teach(language: string, topic: string) => (topicTaught: TopicTaught)
    - ListAvailabilities() => (timeSlots: []TimeSlot)
    - AddAvailability(req: AddAvailabilityRequest) => (timeSlots: []TimeSlot)
    - UpdateAvailability(req: EditAvailabilityRequest) => (timeSlots: []TimeSlot)
    - DeleteAvailability(id: string)
    - CancelClass(classId: string) => (usersInClass: []User, teacher: User)
    - StartClass(classId: string)
    - EndClass(classId: string)

service ClassServiceAPI
    - ListLanguages() => (languages: []string)
    - ListTopics() => (topics: []string)
    - ListAvailableTopicsTaught() => (topicsTaught: []TopicTaught)
    - ListTeachersForTopicTaught(lang: string, topic: string) => (teachers: []Teacher)
    - ListTopicsTaughtOfTeacher(teacherId: string) => (topicsTaught: []TopicTaught)
    - ListTeacherAvailabilities(teacherId: string) => (timeSlots: []TimeSlot)
    - ShowClassDetails(classId: string) => (classDetails: ClassDetails)
    - GetJoinToken(roomId: string) => (token: string)
    - CreateOrJoinClass(req: CreateClassRequest) => (class: Class)

service MessageServiceAPI
    - SendMessage(message: Message)


#################### SERVICES ####################


#################### ERRORS ####################

error 401 Unauthorized "Unauthorized access" HTTP 401
error 403 PermissionDenied "Permission denied" HTTP 403
error 1 UserAlreadyRegistered "User already registered" HTTP 400

#################### ERRORS ####################